<Window x:Class="TodoWpfApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:TodoWpfApp"
        xmlns:models="clr-namespace:TodoWpfApp.Models"
        xmlns:md="http://markdown.Xaml"
        Title="Enhanced To-Do List" Height="500" Width="850">
    <Grid>
        <!-- Define rows: control bar, grid, details -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="200"/>
        </Grid.RowDefinitions>

        <!-- Control bar -->
        <StackPanel Orientation="Horizontal" Margin="5" Grid.Row="0">
            <Button x:Name="AddButton" Content="Add Task" Margin="2" Click="AddButton_Click"/>
            <Button x:Name="EditButton" Content="Edit Task" Margin="2" Click="EditButton_Click"/>
            <Button x:Name="CompleteButton" Content="Mark Complete" Margin="2" Click="CompleteButton_Click"/>
            <Button x:Name="DeleteButton" Content="Delete Task" Margin="2" Click="DeleteButton_Click"/>
            <TextBlock Text="Filter:" VerticalAlignment="Center" Margin="10,0,0,0"/>
            <ComboBox x:Name="FilterComboBox" Width="120" SelectionChanged="FilterComboBox_SelectionChanged" SelectedIndex="1">
                <ComboBoxItem Content="All"/>
                <ComboBoxItem Content="Pending"/>
                <ComboBoxItem Content="Completed"/>
            </ComboBox>
        </StackPanel>

        <!-- Data grid for tasks -->
        <DataGrid x:Name="TasksGrid" Grid.Row="1" AutoGenerateColumns="False" Margin="5" SelectionMode="Single" SelectionChanged="TasksGrid_SelectionChanged" CanUserSortColumns="True">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Title" Binding="{Binding Title}" SortMemberPath="Title" Width="2*"/>
                <DataGridTextColumn Header="Due Date" Binding="{Binding DueDate, StringFormat=d}" SortMemberPath="DueDate" Width="*"/>
                <DataGridTextColumn Header="Priority" Binding="{Binding Priority}" SortMemberPath="Priority" Width="*"/>
                <DataGridTextColumn Header="Status" Binding="{Binding Status}" SortMemberPath="Completed" Width="*"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Details area -->
        <ScrollViewer Grid.Row="2" Margin="5" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <TextBlock Text="Description:" FontWeight="Bold"/>
                <Grid Margin="0,0,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="DescriptionText" Grid.Column="0" IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap" Height="120"/>
                    <md:MarkdownScrollViewer x:Name="DescriptionMarkdown" Grid.Column="1" Margin="5,0,0,0" MinHeight="120" IsEnabled="False" />
                </Grid>
                <TextBlock Text="Attachments:" FontWeight="Bold"/>
                <StackPanel x:Name="AttachmentsPanel" Margin="0,0,0,5"/>
                <TextBlock Text="Subtasks:" FontWeight="Bold"/>
                <ItemsControl x:Name="SubtasksDetailsPanel">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="0,0,0,6">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,2">
                                    <CheckBox IsChecked="{Binding Completed, Mode=TwoWay}" Checked="Subtask_CheckChanged" Unchecked="Subtask_CheckChanged"/>
                                    <TextBlock Text="{Binding Title}" Margin="5,0,0,0"/>
                                </StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="{Binding Description}" TextWrapping="Wrap" Grid.Column="0">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsMarkdown}" Value="False">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    <md:MarkdownScrollViewer Markdown="{Binding Description}" Grid.Column="1" Margin="5,0,0,0">
                                        <md:MarkdownScrollViewer.Style>
                                            <Style TargetType="md:MarkdownScrollViewer">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsMarkdown}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </md:MarkdownScrollViewer.Style>
                                    </md:MarkdownScrollViewer>
                                </Grid>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>