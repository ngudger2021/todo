<Window x:Class="TodoWpfApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:TodoWpfApp"
        xmlns:models="clr-namespace:TodoWpfApp.Models"
        Icon="/ChatGPT Image Jan 29, 2026, 02_10_29 PM.png"
        Title="To-Do 2.0" Height="800" Width="1100" MinHeight="600" MinWidth="900">
    <Window.InputBindings>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding AddTaskCommand}"/>
        <KeyBinding Key="E" Modifiers="Ctrl" Command="{Binding EditTaskCommand}"/>
        <KeyBinding Key="D" Modifiers="Ctrl" Command="{Binding DeleteTaskCommand}"/>
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding FocusSearchCommand}"/>
        <KeyBinding Key="Enter" Modifiers="Ctrl" Command="{Binding CompleteTaskCommand}"/>
        <KeyBinding Key="F5" Command="{Binding RefreshCommand}"/>
    </Window.InputBindings>
    <Window.Resources>
        <local:StatusTagConverter x:Key="StatusTagConverter"/>
        <local:StatusTagsToBrushConverter x:Key="StatusTagsToBrushConverter"/>
        <local:StatusTagsToForegroundConverter x:Key="StatusTagsToForegroundConverter"/>
    </Window.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="119*"/>
            <ColumnDefinition Width="557*"/>
            <ColumnDefinition Width="424*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Quick Add Bar -->
        <Border Grid.Row="0" Padding="10" Background="{DynamicResource SecondaryBackgroundBrush}" Grid.ColumnSpan="3">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox x:Name="QuickAddTextBox" Grid.Column="0"
                         local:WatermarkHelper.Watermark="Quick add: 'Buy milk tomorrow 3pm #shopping !high'"
                         VerticalAlignment="Center" Padding="5"
                         KeyDown="QuickAddTextBox_KeyDown"/>
                <Button x:Name="VoiceInputButton" Grid.Column="1" Content="ðŸŽ¤ Voice" Width="80"
                        Margin="5,0,0,0" Click="VoiceInputButton_Click" ToolTip="Voice input"/>
                <Button x:Name="QuickAddButton" Grid.Column="2" Content="âž• Add" Width="80"
                        Margin="5,0,0,0" Click="QuickAddButton_Click"/>
            </Grid>
        </Border>

        <!-- Control bar split across two rows so buttons and filters always fit without horizontal scrolling -->
        <Border Grid.Row="1" Padding="10" Background="{DynamicResource SecondaryBackgroundBrush}" Grid.ColumnSpan="3">
            <StackPanel>
                <WrapPanel VerticalAlignment="Center" Margin="0,0,0,6" ItemWidth="120" ItemHeight="32">
                    <Button x:Name="AddButton" Content="Add Task" Margin="2" Click="AddButton_Click"/>
                    <Button x:Name="EditButton" Content="Edit Task" Margin="2" Click="EditButton_Click"/>
                    <Button x:Name="CompleteButton" Content="Mark Complete" Margin="2" Click="CompleteButton_Click"/>
                    <Button x:Name="DeleteButton" Content="Delete Task" Margin="2" Click="DeleteButton_Click"/>
                    <Button x:Name="StatisticsButton" Content="Statistics" Margin="2" Click="StatisticsButton_Click"/>
                    <Button x:Name="ExportButton" Content="Export" Margin="2" Click="ExportButton_Click"/>
                    <Button x:Name="HistoryButton" Content="History" Margin="2" Click="HistoryButton_Click"/>
                    <Button x:Name="NotificationsButton" Content="Notifications" Margin="2" Click="NotificationsButton_Click"/>
                    <Button x:Name="GeneralNotesButton" Content="General Notes" Margin="2" Click="GeneralNotesButton_Click"/>
                    <Button x:Name="HelpButton" Content="Shortcuts" Margin="2" Click="HelpButton_Click"/>
                </WrapPanel>
                <WrapPanel VerticalAlignment="Center" ItemHeight="32">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="2">
                        <TextBlock Text="Status:" VerticalAlignment="Center"/>
                        <ComboBox x:Name="StatusFilterComboBox" Width="120" Margin="5,0,0,0" SelectionChanged="FilterBar_Changed" SelectedIndex="1">
                            <ComboBoxItem Content="All"/>
                            <ComboBoxItem Content="Pending"/>
                            <ComboBoxItem Content="Completed"/>
                        </ComboBox>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="2">
                        <TextBlock Text="Tag:" VerticalAlignment="Center"/>
                        <ComboBox x:Name="TagFilterComboBox" Width="140" Margin="5,0,0,0" SelectionChanged="FilterBar_Changed"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="2">
                        <TextBlock Text="Search:" VerticalAlignment="Center"/>
                        <TextBox x:Name="SearchTextBox" Width="160" Margin="5,0,0,0" TextChanged="SearchTextBox_TextChanged"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="2">
                        <TextBlock Text="Group by:" VerticalAlignment="Center"/>
                        <ComboBox x:Name="GroupByComboBox" Width="140" Margin="5,0,0,0" SelectionChanged="GroupByComboBox_SelectionChanged" SelectedIndex="0">
                            <ComboBoxItem Content="None"/>
                            <ComboBoxItem Content="Due Date"/>
                            <ComboBoxItem Content="Tag"/>
                        </ComboBox>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="2">
                        <CheckBox x:Name="ReminderToggle" Content="Enable Reminders" Checked="ReminderToggle_Changed" Unchecked="ReminderToggle_Changed" VerticalAlignment="Center"/>
                        <StackPanel Orientation="Horizontal" Margin="10,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="Lead time (hours):" VerticalAlignment="Center"/>
                            <TextBox x:Name="ReminderLeadTimeTextBox" Width="50" Margin="5,0,0,0" LostFocus="ReminderLeadTimeTextBox_LostFocus" KeyDown="ReminderLeadTimeTextBox_KeyDown"/>
                        </StackPanel>
                    </StackPanel>
                </WrapPanel>
                <WrapPanel VerticalAlignment="Center" ItemHeight="32" Margin="0,6,0,0">
                    <TextBlock Text="View:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <RadioButton x:Name="MainFormViewRadio" Content="Main Form" GroupName="ViewMode" IsChecked="True"
                                 Margin="0,0,15,0" VerticalAlignment="Center" Checked="ViewMode_Changed"/>
                    <RadioButton x:Name="KanbanViewRadio" Content="Kanban Board" GroupName="ViewMode"
                                 VerticalAlignment="Center" Checked="ViewMode_Changed"/>
                </WrapPanel>
            </StackPanel>
        </Border>

        <!-- Main content area keeps grid and details side by side to utilise full width -->
        <Grid Grid.Row="2" Margin="5" Grid.ColumnSpan="3" x:Name="MainFormView">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <DataGrid x:Name="TasksGrid" Grid.Column="0" AutoGenerateColumns="False" Margin="0,0,5,0"
                      SelectionMode="Single" SelectionChanged="TasksGrid_SelectionChanged"
                      CanUserSortColumns="True" MouseDoubleClick="TasksGrid_MouseDoubleClick"
                      AllowDrop="True" PreviewMouseLeftButtonDown="TasksGrid_PreviewMouseLeftButtonDown"
                      Drop="TasksGrid_Drop" DragOver="TasksGrid_DragOver">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Title" Binding="{Binding Title}" SortMemberPath="Title" Width="2*"/>
                    <DataGridTextColumn Header="Due Date" Binding="{Binding DueDate, StringFormat=d}" SortMemberPath="DueDate" Width="*"/>
                    <DataGridTextColumn Header="Priority" Binding="{Binding Priority}" SortMemberPath="Priority" Width="*"/>
                    <DataGridTemplateColumn Header="Tags" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ItemsControl ItemsSource="{Binding Tags}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="{DynamicResource AccentBrush}" CornerRadius="3" Padding="4" Margin="2,1">
                                                <TextBlock Text="{Binding}" Foreground="{DynamicResource AccentForegroundBrush}" />
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Status" SortMemberPath="Completed" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="3"
                                        Padding="4,2"
                                        Background="{Binding Tags, Converter={StaticResource StatusTagsToBrushConverter}}">
                                    <TextBlock Text="{Binding Tags, Converter={StaticResource StatusTagConverter}}"
                                               Foreground="{Binding Tags, Converter={StaticResource StatusTagsToForegroundConverter}}"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <Border Grid.Column="1" Padding="10" Background="{DynamicResource SecondaryBackgroundBrush}" BorderBrush="{DynamicResource ControlBorderBrush}" BorderThickness="1" CornerRadius="4">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Description:" FontWeight="Bold"/>
                        <TextBox x:Name="DescriptionText" Margin="0,4,0,10" IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="80" VerticalScrollBarVisibility="Auto"/>
                        <TextBlock Text="Note:" FontWeight="Bold"/>
                        <Grid Margin="0,4,0,10">
                            <TextBox x:Name="NoteText"
                                     IsReadOnly="True"
                                     AcceptsReturn="True"
                                     TextWrapping="Wrap"
                                     MinHeight="60"
                                     VerticalScrollBarVisibility="Auto"/>
                            <FlowDocumentScrollViewer x:Name="NoteMarkdownView"
                                                      Visibility="Collapsed"
                                                      MinHeight="60"/>
                        </Grid>
                        <TextBlock Text="Attachments:" FontWeight="Bold"/>
                        <StackPanel x:Name="AttachmentsPanel" Margin="0,4,0,10"/>
                        <TextBlock Text="Tags:" FontWeight="Bold"/>
                        <WrapPanel x:Name="TagsPanel" Margin="0,4,0,10" />
                        <TextBlock Text="Subtasks:" FontWeight="Bold"/>
                        <ItemsControl x:Name="SubtasksDetailsPanel">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0,0,0,10">
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,2">
                                            <CheckBox IsChecked="{Binding Completed, Mode=TwoWay}" Checked="Subtask_CheckChanged" Unchecked="Subtask_CheckChanged"/>
                                            <TextBlock Text="{Binding Title}" Margin="5,0,0,0"/>
                                        </StackPanel>
                                        <TextBlock Text="{Binding Description}" TextWrapping="Wrap" Margin="0,2,0,0"/>
                                        <StackPanel Margin="0,6,0,0">
                                            <StackPanel.Style>
                                                <Style TargetType="StackPanel">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Attachments.Count}" Value="0">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </StackPanel.Style>
                                            <TextBlock Text="Attachments:" FontWeight="Bold" Margin="0,0,0,2"/>
                                            <ItemsControl ItemsSource="{Binding Attachments}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding}" Foreground="Blue" TextDecorations="Underline" Cursor="Hand" Margin="0,0,0,2" MouseLeftButtonUp="SubtaskAttachment_Click" />
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Kanban Board View (initially hidden) -->
        <Border x:Name="KanbanBoardContainer" Grid.Row="2" Grid.ColumnSpan="3" Visibility="Collapsed">
            <!-- KanbanBoardView will be dynamically added here -->
        </Border>
    </Grid>
</Window>
