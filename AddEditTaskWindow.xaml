<Window x:Class="TodoWpfApp.AddEditTaskWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="clr-namespace:TodoWpfApp.Models"
        xmlns:md="http://markdown.Xaml"
        Title="Task" Height="650" Width="500" ResizeMode="CanResizeWithGrip">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </Window.Resources>
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="10">
            <!-- Define rows for each UI element.  Row 3 holds the description area and is resizable via a GridSplitter
                 in row 4.  Row 5 contains a checkbox to choose between plain text and Markdown descriptions. -->
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Title label -->
                <RowDefinition Height="Auto"/> <!-- Title textbox -->
                <RowDefinition Height="Auto"/> <!-- Description label -->
                <RowDefinition Height="200"/> <!-- Description textbox -->
                <RowDefinition Height="Auto"/> <!-- GridSplitter -->
                <RowDefinition Height="Auto"/> <!-- Markdown toggle -->
                <RowDefinition Height="Auto"/> <!-- Markdown preview label -->
                <RowDefinition Height="200"/> <!-- Markdown preview viewer -->
                <RowDefinition Height="Auto"/> <!-- Due date label -->
                <RowDefinition Height="Auto"/> <!-- DatePicker -->
                <RowDefinition Height="Auto"/> <!-- Priority label -->
                <RowDefinition Height="Auto"/> <!-- Priority combo -->
                <RowDefinition Height="Auto"/> <!-- Tags label -->
                <RowDefinition Height="Auto"/> <!-- Tags textbox -->
                <RowDefinition Height="Auto"/> <!-- Attachments group -->
                <RowDefinition Height="Auto"/> <!-- Subtasks group -->
                <RowDefinition Height="Auto"/> <!-- Buttons -->
            </Grid.RowDefinitions>
            <!-- Title -->
            <TextBlock Text="Title:" Grid.Row="0"/>
            <TextBox x:Name="TitleTextBox" Grid.Row="1" Margin="0,2,0,5"/>
            <!-- Description -->
            <TextBlock Text="Description:" Grid.Row="2" Margin="0,5,0,0"/>
            <TextBox x:Name="DescriptionTextBox" Grid.Row="3" AcceptsReturn="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" VerticalAlignment="Stretch"/>
            <!-- Grid splitter to resize description -->
            <GridSplitter Grid.Row="4" HorizontalAlignment="Stretch" Height="5" Background="LightGray" VerticalAlignment="Center" ShowsPreview="True"/>
            <!-- Markdown toggle -->
            <CheckBox x:Name="MarkdownCheckBox" Grid.Row="5" Content="Use Markdown for description" Margin="0,5,0,0" IsChecked="{Binding IsMarkdown, Mode=TwoWay}"/>
            <!-- Markdown preview -->
            <TextBlock Text="Preview:" Grid.Row="6" Margin="0,5,0,0"/>
            <md:MarkdownScrollViewer Grid.Row="7" Markdown="{Binding Text, ElementName=DescriptionTextBox}" Margin="0,2,0,0"
                                      Visibility="{Binding IsChecked, ElementName=MarkdownCheckBox, Converter={StaticResource BoolToVisibilityConverter}}"/>
            <!-- Due date -->
            <TextBlock Text="Due Date:" Grid.Row="8" Margin="0,5,0,0"/>
            <DatePicker x:Name="DueDatePicker" Grid.Row="9"/>
            <!-- Priority -->
            <TextBlock Text="Priority:" Grid.Row="10" Margin="0,5,0,0"/>
            <ComboBox x:Name="PriorityComboBox" Grid.Row="11" SelectedIndex="1">
                <ComboBoxItem Content="High"/>
                <ComboBoxItem Content="Medium"/>
                <ComboBoxItem Content="Low"/>
            </ComboBox>
            <!-- Tags -->
            <TextBlock Text="Tags (comma separated):" Grid.Row="12" Margin="0,5,0,0"/>
            <TextBox x:Name="TagsTextBox" Grid.Row="13" Margin="0,2,0,5"/>
            <!-- Attachments -->
            <GroupBox Header="Attachments" Grid.Row="14" Margin="0,10,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <ListBox x:Name="AttachmentsListBox" Grid.Row="0"/>
                    <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,5,0,0">
                        <Button Content="Add..." Click="AddAttachment_Click" Width="80"/>
                        <Button Content="Remove" Click="RemoveAttachment_Click" Width="80" Margin="5,0,0,0"/>
                    </StackPanel>
                </Grid>
            </GroupBox>
            <!-- Subtasks -->
            <GroupBox Header="Subtasks" Grid.Row="15" Margin="0,10,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <ListBox x:Name="SubtasksListBox" Grid.Row="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,2">
                                    <CheckBox IsChecked="{Binding Completed, Mode=TwoWay}" Width="20"/>
                                    <TextBox Text="{Binding Title, Mode=TwoWay}" Width="280"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,5,0,0">
                        <Button Content="Add Subtask" Click="AddSubtask_Click" Width="100"/>
                        <Button Content="Edit Subtask" Click="EditSubtask_Click" Width="100" Margin="5,0,0,0"/>
                        <Button Content="Remove Subtask" Click="RemoveSubtask_Click" Width="120" Margin="5,0,0,0"/>
                    </StackPanel>
                </Grid>
            </GroupBox>
            <!-- Buttons -->
            <StackPanel Orientation="Horizontal" Grid.Row="16" HorizontalAlignment="Right" Margin="0,10,0,0">
                <Button x:Name="SaveButton" Content="Save" Width="90" Margin="0,0,5,0" Click="SaveButton_Click"/>
                <Button Content="Cancel" Width="90" Click="CancelButton_Click"/>
            </StackPanel>
        </Grid>
    </ScrollViewer>
</Window>